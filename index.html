<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Consulta de Calificaciones</title>
  <style>
    #score-app { max-width: 800px; margin: 2rem auto; padding: 1rem; font-family: sans-serif; }
    .rol-input { display: flex; gap: .5rem; align-items: center; flex-wrap: wrap; }
    .rol-input label { font-weight: bold; }
    .rol-input input { flex: 1 1 200px; padding: .5rem; font-size: 1rem; }
    .rol-input button { padding: .5rem 1rem; font-size: 1rem; cursor: pointer; }
    .notas-grid { display: grid; gap: 1rem; margin-top: 1rem;
                  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    .campo { display: flex; flex-direction: column; }
    .campo label { font-weight: bold; margin-bottom: .25rem; font-size: .9rem; }
    .campo input { padding: .5rem; border: 1px solid #ccc; border-radius: 4px; background: #f9f9f9; }
  </style>
</head>
<body>
  <div id="score-app">
    <!-- Paso 1: Input de ROL -->
    <div class="rol-input">
      <label for="rol">Ingrese su ROL USM:</label>
      <input type="text" id="rol" placeholder="Ej. 201912003">
      <button id="buscar">Buscar</button>
    </div>

    <!-- Paso 2: Resultados -->
    <div id="resultados" style="display:none; margin-top:1rem;">
      <h2 id="nombre-estudiante"></h2>
      <div class="notas-grid">
        <div class="campo"><label>PG1. Diagrama de Flujo</label><input id="pg1" readonly></div>
        <div class="campo"><label>PG2. Herramienta Lean</label><input id="pg2" readonly></div>
        <div class="campo"><label>PG3. Diagnóstico de Pérdidas</label><input id="pg3" readonly></div>
        <div class="campo"><label>PG4. Estrategias de Implementación</label><input id="pg4" readonly></div>
        <div class="campo"><label>Promedio Presentación y Trabajos</label><input id="promedio-presentacion-trabajos" readonly></div>
        <div class="campo"><label>Tarea 1. VSM</label><input id="tarea-vsm" readonly></div>
        <div class="campo"><label>Tarea 2. 5S</label><input id="tarea-5s" readonly></div>
        <div class="campo"><label>Promedio Tareas</label><input id="promedio-tareas" readonly></div>
        <div class="campo"><label>Proyecto Final</label><input id="proyecto-final" readonly></div>
        <div class="campo"><label>Puntos Extra por participación VR</label><input id="puntos-extra-vr" readonly></div>
        <div class="campo"><label>Participación Jenga Lean</label><input id="jenga-lean" readonly></div>
        <div class="campo"><label>Reporte A3</label><input id="reporte-a3" readonly></div>
        <div class="campo"><label>Nota Final</label><input id="nota-final" readonly></div>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // ► sustituye esta URL por la tuya
    const apiUrl = 'https://script.google.com/macros/s/AKfycbzxca5go5Fh4rnoYvKRG23gkBqL6fdofRTn8w6KHB0jbxhWhnzAlg73wsGRWIdK6FS1VQ/exec';

    document.getElementById('buscar').addEventListener('click', () => {
      const rol = document.getElementById('rol').value.trim();
      if (!rol) return alert('Ingresa tu ROL');

      fetch(`${apiUrl}?rol=${encodeURIComponent(rol)}`)
        .then(res => {
          if (!res.ok) throw new Error('Error al conectar con el servidor');
          return res.json();
        })
        .then(data => {
          if (data.error) throw new Error(data.error);

          // Nombre
          document.getElementById('nombre-estudiante').textContent = data['Nombre'] || '';

          // Mapa de campos JSON → IDs de inputs
          const map = {
            'PG1': 'pg1', 'PG2': 'pg2', 'PG3': 'pg3', 'PG4': 'pg4',
            'Presentaciones y Trabajos': 'promedio-presentacion-trabajos',
            'Tarea VSM': 'tarea-vsm', 'Tarea 5S': 'tarea-5s', 'Tareas': 'promedio-tareas',
            'Proyecto': 'proyecto-final', 'Puntos extra': 'puntos-extra-vr',
            'Jenga Lean': 'jenga-lean', 'Reporte A3': 'reporte-a3', 'Nota Final': 'nota-final'
          };

          // Rellenar inputs
          Object.entries(map).forEach(([key,id]) => {
            document.getElementById(id).value = data[key] !== undefined ? data[key] : '';
          });

          document.getElementById('resultados').style.display = 'block';
        })
        .catch(err => {
          alert(err.message);
        });
    });
  });
  </script>
</body>
</html>
